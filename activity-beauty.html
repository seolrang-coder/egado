<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>무료 이·미용 봉사 | 관악구장애인단체연합회</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--brand:#4b4b8f;--brand-dark:#352f74;--muted:#6c757d;--bg:#f3f3f3}
    body{font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#fff;color:#222}
    .topbar{font-size:12px;background:#f8f9fa;border-bottom:1px solid #e9ecef}
    .navbar-brand img{height:44px}
    .brand-title{font-weight:800;color:var(--brand-dark);font-size:1.95rem;letter-spacing:-.2px}
    @media (max-width: 576px){.brand-title{display:none}}
    .mainnav{border-bottom:1px solid #e9ecef}
    .mainnav .nav-link{font-weight:600;color:#333}
    .mainnav .nav-link:hover{color:var(--brand)}
    .footer{background:#2d2142;color:#d9d6e5}
    .footer a{color:#e3def2;text-decoration:none}
    .footer a:hover{text-decoration:underline}
    .footer-brand img{height:36px}
    .post-card{transition:transform 0.3s ease,box-shadow 0.3s ease;border:0;border-radius:0.75rem;overflow:hidden;height:100%;box-shadow:0 2px 10px rgba(0,0,0,0.08)}
    .post-card:hover{transform:translateY(-5px);box-shadow:0 8px 20px rgba(0,0,0,0.15)}
    .post-image{width:100%;height:250px;object-fit:cover;background:linear-gradient(135deg,#f8d7da 0%,#ffe0e6 100%)}
    .post-image-placeholder{width:100%;height:250px;background:linear-gradient(135deg,#f8d7da 0%,#ffe0e6 100%);display:flex;align-items:center;justify-content:center;color:#6c757d}
    .admin-controls{display:none}
    .admin-controls.show{display:flex;gap:0.5rem}
    .empty-state{text-align:center;padding:4rem 2rem;color:#6c757d}
    .empty-state i{font-size:4rem;opacity:0.3;margin-bottom:1rem;display:block}
  </style>
</head>
<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="container d-flex justify-content-end align-items-center gap-3 py-1">
      <div id="userInfo" style="display:none;">
        <span id="usernameDisplay" class="text-muted me-2"></span>
        <form action="/logout" method="post" style="display:inline;">
          <button type="submit" class="btn btn-link link-secondary p-0" style="text-decoration:none;">로그아웃</button>
        </form>
      </div>
      <div id="guestInfo">
        <a href="login.html" class="link-secondary">로그인</a>
        <a href="register.html" class="link-secondary">회원가입</a>
      </div>
    </div>
  </div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white mainnav">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-3" href="index.html">
        <img src="img/footer-logo.png" alt="로고" />
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="토글 내비게이션">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="about.html" id="aboutDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">협회소개</a>
            <ul class="dropdown-menu" aria-labelledby="aboutDropdown">
              <li><a class="dropdown-item" href="about.html">협회소개</a></li>
              <li><a class="dropdown-item" href="org.html">조직도</a></li>
              <li><a class="dropdown-item" href="history.html">연혁</a></li>
              <li><a class="dropdown-item" href="vision.html">비전</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="business.html">협회사업</a></li>
          <li class="nav-item"><a class="nav-link" href="info.html">정보마당</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle active" href="activity-lovehouse.html" id="activityDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">행사 및 활동</a>
            <ul class="dropdown-menu" aria-labelledby="activityDropdown">
              <li><a class="dropdown-item" href="activity-lovehouse.html">러브하우스</a></li>
              <li><a class="dropdown-item" href="activity-volunteer.html">행사 및 환경봉사단</a></li>
              <li><a class="dropdown-item" href="activity-mobilitycare.html">전동보장구교육&케어</a></li>
              <li><a class="dropdown-item" href="activity-beauty.html">무료 이·미용 봉사</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="board.html">게시판</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="affiliateDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">연합회소속단체</a>
            <ul class="dropdown-menu" aria-labelledby="affiliateDropdown">
              <li><a class="dropdown-item" href="http://www.sappd.or.kr/" target="_blank" rel="noopener noreferrer">사)서울지체장애인협회</a></li>
              <li><a class="dropdown-item" href="http://www.kadi.or.kr/kadi/" target="_blank" rel="noopener noreferrer">사)한국장애인정보화협회</a></li>
              <li><a class="dropdown-item" href="https://kaiad.or.kr/" target="_blank" rel="noopener noreferrer">사)한국산업재해장애인협회</a></li>
              <li><a class="dropdown-item" href="http://www.kaed.or.kr/" target="_blank" rel="noopener noreferrer">사)한국장애인기업협회</a></li>
              <li><a class="dropdown-item" href="http://www.nanum.tv/" target="_blank" rel="noopener noreferrer">사)국제장애인문화교류협회</a></li>
              <li><a class="dropdown-item" href="http://www.kofd.co.kr/kofd/" target="_blank" rel="noopener noreferrer">사)한국기능장애인협회</a></li>
              <li><a class="dropdown-item" href="https://www.deafkorea.com/main/" target="_blank" rel="noopener noreferrer">사)한국농아인협회</a></li>
              <li><a class="dropdown-item" href="http://www.bluesky82.org/" target="_blank" rel="noopener noreferrer">사)한국장애인문화협회</a></li>
              <li><a class="dropdown-item" href="https://www.kdwa.or.kr/main" target="_blank" rel="noopener noreferrer">사)서울신체장애인복지회</a></li>
              <li><a class="dropdown-item" href="#">사)열린정보장애인협회</a></li>
              <li><a class="dropdown-item" href="#">사)서울시각장애인연합회</a></li>
              <li><a class="dropdown-item" href="#">사)한국장애인환경실천협회</a></li>
              <li><a class="dropdown-item" href="nanum.html">전국장애인나눔협동조합</a></li>
              <li><a class="dropdown-item" href="aboutgolf.html">한국장애인스크린파크골프협회</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="directions.html">오시는길</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-5">
    <!-- 페이지 헤더 -->
    <section class="page-header text-center mb-5">
      <div class="header-decoration mb-3">
        <i class="bi bi-scissors display-6 text-danger"></i>
      </div>
      <h2 class="display-8 fw-bold text-dark mb-3">무료 이·미용 봉사</h2>
      <p class="lead text-muted">정기 봉사 활동 안내</p>
      <div class="admin-controls mt-3" id="adminControls">
        <a href="/category/beauty/new" class="btn btn-danger">
          <i class="bi bi-pencil-square me-1"></i>글 작성
        </a>
      </div>
    </section>

    <div id="postsContainer" class="row g-4">
      <div class="col-12 text-center py-5">
        <div class="spinner-border text-danger" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>
    <nav id="paginationContainer" aria-label="페이지 네비게이션" class="mt-5">
      <!-- 페이지네이션이 여기에 동적으로 생성됩니다 -->
    </nav>
  </main>

  <!-- Footer -->
  <footer class="footer pt-4 pb-5 mt-5">
    <div class="container">
      <div class="row g-3">
        <div class="col-12 col-lg-8">
          <a class="footer-brand d-inline-flex align-items-center gap-2 mb-2" href="index.html">
            <img src="img/main.jpg" alt="관악구장애인단체연합회 로고" />
            <span class="fw-bold text-white">관악구장애인단체연합회</span>
          </a>
          <div class="small text-secondary">고유번호:119-82-74874 | 협회장: 송 낙 규</div>
          <div class="small text-secondary">서울특별시 남부순환로 1696, 뉴명지빌딩 (5,6,7층) | 대표 02-871-5686 | FAX 02-3281-3702</div>
          <div class="small text-secondary">Copyright &copy; 2025 관악구장애인단체연합회. All Rights Reserved.</div>
        </div>
        <div class="col-12 col-lg-4">
          <div class="d-flex gap-3 justify-content-lg-end small">
            <a href="terms.html">이용약관</a>
            <a href="privacy.html">개인정보처리방침</a>
            <a href="email-policy.html">이메일무단수집거부</a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let currentPage = 1;
    
    async function loadPosts(page = 1) {
      try {
        currentPage = page;
        const res = await fetch(`/category/beauty?page=${page}`, {
          credentials: 'include'
        });
        const data = await res.json();
        const container = document.getElementById('postsContainer');
        const paginationContainer = document.getElementById('paginationContainer');
        
        if (!data.posts || data.posts.length === 0) {
          container.innerHTML = `
            <div class="col-12">
              <div class="empty-state">
                <i class="bi bi-inbox"></i>
                <p class="mb-0">등록된 게시글이 없습니다.</p>
              </div>
            </div>
          `;
          paginationContainer.innerHTML = '';
          return;
        }
        
        container.innerHTML = data.posts.map(post => {
          const date = new Date(post.created_at);
          const formattedDate = date.toLocaleDateString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
          
          return `
            <div class="col-12 col-md-6 col-lg-4">
              <div class="post-card card h-100">
                ${post.first_image 
                  ? `<img src="${post.first_image}" class="post-image" alt="${post.title || '게시글 이미지'}">` 
                  : `<div class="post-image-placeholder"><i class="bi bi-image fs-1"></i></div>`
                }
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title fw-bold mb-3">${escapeHtml(post.title || '제목 없음')}</h5>
                  <div class="small text-muted mb-3 d-flex align-items-center gap-2">
                    <i class="bi bi-person"></i>
                    <span>${escapeHtml(post.username || '작성자')}</span>
                    <span class="mx-1">·</span>
                    <i class="bi bi-calendar3"></i>
                    <span>${formattedDate}</span>
                  </div>
                  <div class="mt-auto d-flex gap-2">
                    <a href="/category/beauty/posts/${post.id}" class="btn btn-outline-danger btn-sm flex-grow-1">
                      <i class="bi bi-arrow-right-circle me-1"></i>자세히 보기
                    </a>
                    <div class="admin-controls" id="adminControls-${post.id}">
                      <a href="/category/beauty/posts/${post.id}/edit" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil"></i>
                      </a>
                      <button onclick="deletePost(${post.id})" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }).join('');
        
        // 페이지네이션 생성
        if (data.pagination && data.pagination.totalPages > 1) {
          let paginationHTML = '<ul class="pagination justify-content-center">';
          
          // 이전 페이지
          if (data.pagination.hasPrev) {
            paginationHTML += `<li class="page-item">
              <a class="page-link" href="#" onclick="event.preventDefault(); loadPosts(${data.pagination.currentPage - 1}); return false;">
                <i class="bi bi-chevron-left"></i>
              </a>
            </li>`;
          } else {
            paginationHTML += '<li class="page-item disabled"><span class="page-link"><i class="bi bi-chevron-left"></i></span></li>';
          }
          
          // 페이지 번호
          const startPage = Math.max(1, data.pagination.currentPage - 2);
          const endPage = Math.min(data.pagination.totalPages, data.pagination.currentPage + 2);
          
          if (startPage > 1) {
            paginationHTML += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadPosts(1); return false;">1</a></li>`;
            if (startPage > 2) {
              paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
            }
          }
          
          for (let i = startPage; i <= endPage; i++) {
            if (i === data.pagination.currentPage) {
              paginationHTML += `<li class="page-item active"><span class="page-link">${i}</span></li>`;
            } else {
              paginationHTML += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadPosts(${i}); return false;">${i}</a></li>`;
            }
          }
          
          if (endPage < data.pagination.totalPages) {
            if (endPage < data.pagination.totalPages - 1) {
              paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
            }
            paginationHTML += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadPosts(${data.pagination.totalPages}); return false;">${data.pagination.totalPages}</a></li>`;
          }
          
          // 다음 페이지
          if (data.pagination.hasNext) {
            paginationHTML += `<li class="page-item">
              <a class="page-link" href="#" onclick="event.preventDefault(); loadPosts(${data.pagination.currentPage + 1}); return false;">
                <i class="bi bi-chevron-right"></i>
              </a>
            </li>`;
          } else {
            paginationHTML += '<li class="page-item disabled"><span class="page-link"><i class="bi bi-chevron-right"></i></span></li>';
          }
          
          paginationHTML += '</ul>';
          paginationContainer.innerHTML = paginationHTML;
        } else {
          paginationContainer.innerHTML = '';
        }
        
        checkAdmin();
      } catch (error) {
        console.error('Error loading posts:', error);
        document.getElementById('postsContainer').innerHTML = `
          <div class="col-12">
            <div class="empty-state text-danger">
              <i class="bi bi-exclamation-triangle"></i>
              <p class="mb-0">게시글을 불러오는 중 오류가 발생했습니다.</p>
            </div>
          </div>
        `;
      }
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    async function checkAdmin() {
      try {
        const res = await fetch('/api/check-admin', {
          credentials: 'include'
        });
        const data = await res.json();
        if (data.isAdmin) {
          document.getElementById('adminControls').classList.add('show');
          document.querySelectorAll('.admin-controls').forEach(el => el.classList.add('show'));
        }
      } catch (error) {
        console.error('Error checking admin:', error);
      }
    }
    
    async function deletePost(id) {
      if (!confirm('정말 삭제하시겠습니까?')) return;
      try {
        const res = await fetch(`/category/beauty/posts/${id}/delete`, { 
          method: 'POST',
          credentials: 'include'
        });
        if (res.ok) {
          loadPosts(currentPage);
        }
      } catch (error) {
        console.error('Error deleting post:', error);
        alert('삭제 중 오류가 발생했습니다.');
      }
    }
    
    // 로그인 상태 확인
    async function checkLoginStatus() {
      try {
        const res = await fetch('/api/user', {
          credentials: 'include'
        });
        const data = await res.json();
        
        if (data.loggedIn) {
          document.getElementById('userInfo').style.display = 'block';
          document.getElementById('guestInfo').style.display = 'none';
          document.getElementById('usernameDisplay').textContent = `${data.username}님`;
        } else {
          document.getElementById('userInfo').style.display = 'none';
          document.getElementById('guestInfo').style.display = 'block';
        }
      } catch (error) {
        console.error('Error checking login status:', error);
      }
    }
    
    checkLoginStatus();
    checkAdmin();
    loadPosts(1);
  </script>
</body>
</html>
