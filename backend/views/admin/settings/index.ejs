<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì‚¬ì´íŠ¸ ì„¤ì • | ê´€ì•…êµ¬ì¥ì• ì¸ë‹¨ì²´ì—°í•©íšŒ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    .image-preview{max-width:100%;max-height:300px;object-fit:cover;border-radius:0.5rem;margin-top:1rem;border:2px solid #dee2e6}
    .upload-area{border:2px dashed #dee2e6;border-radius:0.5rem;padding:2rem;text-align:center;transition:all 0.3s ease;cursor:pointer}
    .upload-area:hover{border-color:#4b4b8f;background:#f8f9fa}
    .upload-area.dragover{border-color:#4b4b8f;background:#e7f3ff}
    .announcement-item{border:1px solid #dee2e6;border-radius:0.5rem;padding:1rem;margin-bottom:1rem;background:#fff;transition:all 0.3s ease}
    .announcement-item:hover{box-shadow:0 2px 8px rgba(0,0,0,0.1)}
    .announcement-item.inactive{opacity:0.6;background:#f8f9fa}
    .icon-preview{display:inline-flex;align-items:center;gap:0.5rem;padding:0.5rem;background:#f8f9fa;border-radius:0.25rem;margin-top:0.5rem}
    .icon-preview i{font-size:1.25rem}
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="/index.html">
        <strong>ê´€ì•…êµ¬ì¥ì• ì¸ë‹¨ì²´ì—°í•©íšŒ</strong>
      </a>
      <div class="ms-auto d-flex gap-2 align-items-center flex-wrap">
        <span class="navbar-text">ì•ˆë…•í•˜ì„¸ìš”, <strong><%= currentUser.username %></strong>ë‹˜</span>
        <a href="/admin/users" class="btn btn-outline-primary btn-sm">
          <i class="bi bi-people me-1"></i>íšŒì› ê´€ë¦¬
        </a>
        <a href="/admin/sponsors" class="btn btn-outline-primary btn-sm">
          <i class="bi bi-heart me-1"></i>í›„ì› ê´€ë¦¬
        </a>
        <a href="/admin/settings" class="btn btn-primary btn-sm">
          <i class="bi bi-gear me-1"></i>ì‚¬ì´íŠ¸ ì„¤ì •
        </a>
        <a href="/index.html" class="btn btn-outline-secondary btn-sm">í™ˆìœ¼ë¡œ</a>
        <form action="/logout" method="post" class="d-inline">
          <button type="submit" class="btn btn-outline-secondary btn-sm">ë¡œê·¸ì•„ì›ƒ</button>
        </form>
      </div>
    </div>
  </nav>

  <main class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>ì‚¬ì´íŠ¸ ì„¤ì •</h2>
    </div>

    <div class="row g-4">
      <!-- Hero ì´ë¯¸ì§€ ì„¤ì • -->
      <div class="col-12 col-lg-6">
        <div class="card border-0 shadow-lg">
          <div class="card-header bg-primary text-white border-0 rounded-top-4 py-4">
            <div class="text-center">
              <i class="bi bi-image fs-3 mb-2"></i>
              <h5 class="mb-0 fw-bold">Hero ì´ë¯¸ì§€</h5>
            </div>
          </div>
          <div class="card-body p-4">
            <div class="mb-3">
              <label class="form-label fw-bold">í˜„ì¬ ì´ë¯¸ì§€</label>
              <div class="text-center">
                <img src="<%= heroImage %>" alt="Hero ì´ë¯¸ì§€" class="image-preview" id="heroPreview">
              </div>
            </div>
            <form id="heroImageForm">
              <div class="upload-area mb-3" id="heroUploadArea">
                <i class="bi bi-cloud-upload fs-1 text-muted d-block mb-2"></i>
                <p class="mb-1">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                <small class="text-muted">JPG, PNG, GIF, WEBP (ìµœëŒ€ 50MB)</small>
                <input type="file" id="heroImageInput" name="image" accept="image/*" class="d-none" required>
              </div>
              <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-upload me-1"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œ
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- About ì„¹ì…˜ ì´ë¯¸ì§€ ì„¤ì • -->
      <div class="col-12 col-lg-6">
        <div class="card border-0 shadow-lg">
          <div class="card-header bg-success text-white border-0 rounded-top-4 py-4">
            <div class="text-center">
              <i class="bi bi-image fs-3 mb-2"></i>
              <h5 class="mb-0 fw-bold">About ì„¹ì…˜ ì´ë¯¸ì§€</h5>
            </div>
          </div>
          <div class="card-body p-4">
            <div class="mb-3">
              <label class="form-label fw-bold">í˜„ì¬ ì´ë¯¸ì§€</label>
              <div class="text-center">
                <img src="<%= aboutImage %>" alt="About ì´ë¯¸ì§€" class="image-preview" id="aboutPreview">
              </div>
            </div>
            <form id="aboutImageForm">
              <div class="upload-area mb-3" id="aboutUploadArea">
                <i class="bi bi-cloud-upload fs-1 text-muted d-block mb-2"></i>
                <p class="mb-1">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                <small class="text-muted">JPG, PNG, GIF, WEBP (ìµœëŒ€ 50MB)</small>
                <input type="file" id="aboutImageInput" name="image" accept="image/*" class="d-none" required>
              </div>
              <button type="submit" class="btn btn-success w-100">
                <i class="bi bi-upload me-1"></i>ì´ë¯¸ì§€ ì—…ë¡œë“œ
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- í˜‘íšŒì•Œë¦¼ ë° ê³µì§€ì‚¬í•­ ê´€ë¦¬ -->
      <div class="col-12 mt-4">
        <div class="row g-4">
          <!-- í˜‘íšŒì•Œë¦¼ ê´€ë¦¬ -->
          <div class="col-12 col-lg-6">
            <div class="card border-0 shadow-lg h-100">
              <div class="card-header bg-info text-white border-0 rounded-top-4 py-4">
                <div class="d-flex justify-content-between align-items-center">
                  <div class="text-center flex-grow-1">
                    <i class="bi bi-megaphone fs-3 mb-2"></i>
                    <h5 class="mb-0 fw-bold">í˜‘íšŒì•Œë¦¼ ê´€ë¦¬</h5>
                  </div>
                  <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#addAnnouncementModal">
                    <i class="bi bi-plus-circle me-1"></i>ì¶”ê°€
                  </button>
                </div>
              </div>
          <div class="card-body p-4">
            <p class="text-muted mb-3">ë©”ì¸ í˜ì´ì§€ì˜ "í˜‘íšŒì•Œë¦¼" ì„¹ì…˜ì— í‘œì‹œë  ê³µì§€ì‚¬í•­ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            
            <!-- í˜‘íšŒì•Œë¦¼ ëª©ë¡ -->
            <div id="announcementsList">
              <% if (typeof announcements !== 'undefined' && announcements && announcements.length > 0) { %>
                <% announcements.forEach((announcement) => { %>
                  <div class="announcement-item <%= announcement.is_active === 0 ? 'inactive' : '' %>" data-id="<%= announcement.id %>">
                    <div class="d-flex justify-content-between align-items-start">
                      <div class="flex-grow-1">
                        <div class="d-flex align-items-center gap-2 mb-2">
                          <span class="badge bg-<%= announcement.is_active === 1 ? 'success' : 'secondary' %>">
                            <%= announcement.is_active === 1 ? 'í™œì„±' : 'ë¹„í™œì„±' %>
                          </span>
                          <small class="text-muted">ìˆœì„œ: <%= announcement.display_order %></small>
                        </div>
                        <p class="mb-0" id="content-<%= announcement.id %>"><%= announcement.content %></p>
                        <small class="text-muted">
                          ìƒì„±ì¼: <%= new Date(announcement.created_at).toLocaleString('ko-KR') %>
                          <% if (announcement.updated_at) { %>
                            | ìˆ˜ì •ì¼: <%= new Date(announcement.updated_at).toLocaleString('ko-KR') %>
                          <% } %>
                        </small>
                      </div>
                      <div class="d-flex gap-2">
                        <button class="btn btn-sm btn-outline-primary" onclick="editAnnouncement(<%= announcement.id %>, '<%= announcement.content.replace(/'/g, "\\'").replace(/"/g, '&quot;') %>', <%= announcement.display_order %>, <%= announcement.is_active %>)">
                          <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteAnnouncement(<%= announcement.id %>)">
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="alert alert-info text-center">
                  <i class="bi bi-info-circle me-2"></i>ë“±ë¡ëœ í˜‘íšŒì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>

      <!-- ê³µì§€ì‚¬í•­ ê´€ë¦¬ -->
      <div class="col-12 col-lg-6">
        <div class="card border-0 shadow-lg h-100">
          <div class="card-header bg-warning text-dark border-0 rounded-top-4 py-4">
            <div class="d-flex justify-content-between align-items-center">
              <div class="text-center flex-grow-1">
                <i class="bi bi-bell fs-3 mb-2"></i>
                <h5 class="mb-0 fw-bold">ê³µì§€ì‚¬í•­ ê´€ë¦¬</h5>
              </div>
              <button class="btn btn-dark btn-sm" data-bs-toggle="modal" data-bs-target="#addNoticeModal">
                <i class="bi bi-plus-circle me-1"></i>ì¶”ê°€
              </button>
            </div>
          </div>
          <div class="card-body p-4">
            <p class="text-muted mb-3 small">ë©”ì¸ í˜ì´ì§€ ìš°ì¸¡ "ê³µì§€ì‚¬í•­" ì„¹ì…˜ì— í‘œì‹œë  ê³µì§€ì‚¬í•­ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            
            <!-- ê³µì§€ì‚¬í•­ ëª©ë¡ -->
            <div id="noticesList">
              <% if (typeof notices !== 'undefined' && notices && notices.length > 0) { %>
                <% notices.forEach((notice) => { %>
                  <div class="announcement-item <%= notice.is_active === 0 ? 'inactive' : '' %>" data-id="<%= notice.id %>">
                    <div class="d-flex justify-content-between align-items-start">
                      <div class="flex-grow-1">
                        <div class="d-flex align-items-center gap-2 mb-2">
                          <span class="badge bg-<%= notice.is_active === 1 ? 'success' : 'secondary' %>">
                            <%= notice.is_active === 1 ? 'í™œì„±' : 'ë¹„í™œì„±' %>
                          </span>
                          <small class="text-muted">ìˆœì„œ: <%= notice.display_order %></small>
                        </div>
                        <p class="mb-0" id="notice-title-<%= notice.id %>">
                          <% if (notice.icon_class && notice.icon_color) { %>
                            <i class="bi <%= notice.icon_class %> text-<%= notice.icon_color %> me-2"></i>
                          <% } %>
                          <%= notice.title %>
                        </p>
                        <% if (notice.notice_date) { %>
                          <small class="text-muted">ë‚ ì§œ: <%= notice.notice_date %></small>
                        <% } %>
                        <br>
                        <small class="text-muted">
                          ìƒì„±ì¼: <%= new Date(notice.created_at).toLocaleString('ko-KR') %>
                          <% if (notice.updated_at) { %>
                            | ìˆ˜ì •ì¼: <%= new Date(notice.updated_at).toLocaleString('ko-KR') %>
                          <% } %>
                        </small>
                      </div>
                      <div class="d-flex gap-2">
                        <button class="btn btn-sm btn-outline-primary" onclick="editNotice(<%= notice.id %>, '<%= notice.title.replace(/'/g, "\\'").replace(/"/g, '&quot;') %>', '<%= (notice.icon_class || '').replace(/'/g, "\\'") %>', '<%= (notice.icon_color || '').replace(/'/g, "\\'") %>', '<%= (notice.notice_date || '').replace(/'/g, "\\'") %>', '<%= (notice.link || '').replace(/'/g, "\\'") %>', <%= notice.display_order %>, <%= notice.is_active %>)">
                          <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteNotice(<%= notice.id %>)">
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="alert alert-info text-center">
                  <i class="bi bi-info-circle me-2"></i>ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Hero ì´ë¯¸ì§€ ì—…ë¡œë“œ
    const heroUploadArea = document.getElementById('heroUploadArea');
    const heroImageInput = document.getElementById('heroImageInput');
    const heroImageForm = document.getElementById('heroImageForm');
    const heroPreview = document.getElementById('heroPreview');

    heroUploadArea.addEventListener('click', () => heroImageInput.click());
    heroUploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      heroUploadArea.classList.add('dragover');
    });
    heroUploadArea.addEventListener('dragleave', () => {
      heroUploadArea.classList.remove('dragover');
    });
    heroUploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      heroUploadArea.classList.remove('dragover');
      if (e.dataTransfer.files.length > 0) {
        heroImageInput.files = e.dataTransfer.files;
        previewImage(heroImageInput.files[0], heroPreview);
      }
    });

    heroImageInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        previewImage(e.target.files[0], heroPreview);
      }
    });

    heroImageForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(heroImageForm);
      
      const submitBtn = heroImageForm.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>ì—…ë¡œë“œ ì¤‘...';

      try {
        const response = await fetch('/admin/settings/hero-image', {
          method: 'POST',
          body: formData,
          credentials: 'include'
        });

        const result = await response.json();
        if (result.success) {
          alert('Hero ì´ë¯¸ì§€ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
          heroPreview.src = result.imagePath + '?t=' + Date.now();
          heroImageForm.reset();
        } else {
          alert(result.error || 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
      }
    });

    // About ì´ë¯¸ì§€ ì—…ë¡œë“œ
    const aboutUploadArea = document.getElementById('aboutUploadArea');
    const aboutImageInput = document.getElementById('aboutImageInput');
    const aboutImageForm = document.getElementById('aboutImageForm');
    const aboutPreview = document.getElementById('aboutPreview');

    aboutUploadArea.addEventListener('click', () => aboutImageInput.click());
    aboutUploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      aboutUploadArea.classList.add('dragover');
    });
    aboutUploadArea.addEventListener('dragleave', () => {
      aboutUploadArea.classList.remove('dragover');
    });
    aboutUploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      aboutUploadArea.classList.remove('dragover');
      if (e.dataTransfer.files.length > 0) {
        aboutImageInput.files = e.dataTransfer.files;
        previewImage(aboutImageInput.files[0], aboutPreview);
      }
    });

    aboutImageInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        previewImage(e.target.files[0], aboutPreview);
      }
    });

    aboutImageForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(aboutImageForm);
      
      const submitBtn = aboutImageForm.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>ì—…ë¡œë“œ ì¤‘...';

      try {
        const response = await fetch('/admin/settings/about-image', {
          method: 'POST',
          body: formData,
          credentials: 'include'
        });

        const result = await response.json();
        if (result.success) {
          alert('About ì´ë¯¸ì§€ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
          aboutPreview.src = result.imagePath + '?t=' + Date.now();
          aboutImageForm.reset();
        } else {
          alert(result.error || 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
      }
    });

    function previewImage(file, previewElement) {
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
          previewElement.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }

    // í˜‘íšŒì•Œë¦¼ ê´€ë¦¬ í•¨ìˆ˜ë“¤
    async function saveAnnouncement() {
      const content = document.getElementById('addContent').value.trim();
      const displayOrder = parseInt(document.getElementById('addDisplayOrder').value) || 0;
      
      if (!content) {
        alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        const response = await fetch('/admin/announcements', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include',
          body: JSON.stringify({ content, display_order: displayOrder })
        });

        const result = await response.json();
        if (result.success) {
          alert('í˜‘íšŒì•Œë¦¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
          location.reload();
        } else {
          alert(result.error || 'í˜‘íšŒì•Œë¦¼ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('í˜‘íšŒì•Œë¦¼ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function editAnnouncement(id, content, displayOrder, isActive) {
      document.getElementById('editId').value = id;
      document.getElementById('editContent').value = content;
      document.getElementById('editDisplayOrder').value = displayOrder;
      document.getElementById('editIsActive').checked = isActive === 1;
      
      const modal = new bootstrap.Modal(document.getElementById('editAnnouncementModal'));
      modal.show();
    }

    async function updateAnnouncement() {
      const id = document.getElementById('editId').value;
      const content = document.getElementById('editContent').value.trim();
      const displayOrder = parseInt(document.getElementById('editDisplayOrder').value) || 0;
      const isActive = document.getElementById('editIsActive').checked ? 1 : 0;
      
      if (!content) {
        alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        const response = await fetch(`/admin/announcements/${id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include',
          body: JSON.stringify({ content, display_order: displayOrder, is_active: isActive })
        });

        const result = await response.json();
        if (result.success) {
          alert('í˜‘íšŒì•Œë¦¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
          location.reload();
        } else {
          alert(result.error || 'í˜‘íšŒì•Œë¦¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('í˜‘íšŒì•Œë¦¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function deleteAnnouncement(id) {
      if (!confirm('ì •ë§ ì´ í˜‘íšŒì•Œë¦¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }

      try {
        const response = await fetch(`/admin/announcements/${id}`, {
          method: 'DELETE',
          credentials: 'include'
        });

        const result = await response.json();
        if (result.success) {
          alert('í˜‘íšŒì•Œë¦¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          location.reload();
        } else {
          alert(result.error || 'í˜‘íšŒì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('í˜‘íšŒì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ê³µì§€ì‚¬í•­ ê´€ë¦¬ í•¨ìˆ˜ë“¤
    async function saveNotice() {
      const title = document.getElementById('addNoticeTitle').value.trim();
      const iconClassSelect = document.getElementById('addNoticeIconClass').value.trim();
      const iconClassCustom = document.getElementById('addNoticeIconClassCustom').value.trim();
      const iconClass = iconClassCustom || iconClassSelect;
      const iconColor = document.getElementById('addNoticeIconColor').value;
      const noticeDate = document.getElementById('addNoticeDate').value.trim();
      const link = document.getElementById('addNoticeLink').value.trim();
      const displayOrder = parseInt(document.getElementById('addNoticeDisplayOrder').value) || 0;
      
      if (!title) {
        alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        const response = await fetch('/admin/notices', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include',
          body: JSON.stringify({ 
            title, 
            icon_class: iconClass || null,
            icon_color: iconColor || null,
            notice_date: noticeDate || null,
            link: link || null,
            display_order: displayOrder 
          })
        });

        const result = await response.json();
        if (result.success) {
          alert('ê³µì§€ì‚¬í•­ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
          location.reload();
        } else {
          alert(result.error || 'ê³µì§€ì‚¬í•­ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ê³µì§€ì‚¬í•­ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function editNotice(id, title, iconClass, iconColor, noticeDate, link, displayOrder, isActive) {
      document.getElementById('editNoticeId').value = id;
      document.getElementById('editNoticeTitle').value = title;
      
      // ì•„ì´ì½˜ í´ë˜ìŠ¤ê°€ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸
      const iconClassSelect = document.getElementById('editNoticeIconClass');
      const iconClassCustom = document.getElementById('editNoticeIconClassCustom');
      const iconOptions = Array.from(iconClassSelect.options).map(opt => opt.value);
      
      if (iconClass && iconOptions.includes(iconClass)) {
        iconClassSelect.value = iconClass;
        iconClassCustom.value = '';
      } else {
        iconClassSelect.value = '';
        iconClassCustom.value = iconClass || '';
      }
      
      document.getElementById('editNoticeIconColor').value = iconColor || '';
      document.getElementById('editNoticeDate').value = noticeDate || '';
      document.getElementById('editNoticeLink').value = link || '';
      document.getElementById('editNoticeDisplayOrder').value = displayOrder;
      document.getElementById('editNoticeIsActive').checked = isActive === 1;
      
      // ì•„ì´ì½˜ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
      setTimeout(() => {
        updateIconPreview('editNoticeIconClass', 'editNoticeIconPreview', 'editNoticeIconPreviewIcon', 'editNoticeIconPreviewText', 'editNoticeIconClassCustom');
      }, 100);
      
      const modal = new bootstrap.Modal(document.getElementById('editNoticeModal'));
      modal.show();
    }

    async function updateNotice() {
      const id = document.getElementById('editNoticeId').value;
      const title = document.getElementById('editNoticeTitle').value.trim();
      const iconClassSelect = document.getElementById('editNoticeIconClass').value.trim();
      const iconClassCustom = document.getElementById('editNoticeIconClassCustom').value.trim();
      const iconClass = iconClassCustom || iconClassSelect;
      const iconColor = document.getElementById('editNoticeIconColor').value;
      const noticeDate = document.getElementById('editNoticeDate').value.trim();
      const link = document.getElementById('editNoticeLink').value.trim();
      const displayOrder = parseInt(document.getElementById('editNoticeDisplayOrder').value) || 0;
      const isActive = document.getElementById('editNoticeIsActive').checked ? 1 : 0;
      
      if (!title) {
        alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        const response = await fetch(`/admin/notices/${id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include',
          body: JSON.stringify({ 
            title,
            icon_class: iconClass || null,
            icon_color: iconColor || null,
            notice_date: noticeDate || null,
            link: link || null,
            display_order: displayOrder,
            is_active: isActive
          })
        });

        const result = await response.json();
        if (result.success) {
          alert('ê³µì§€ì‚¬í•­ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
          location.reload();
        } else {
          alert(result.error || 'ê³µì§€ì‚¬í•­ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ê³µì§€ì‚¬í•­ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function deleteNotice(id) {
      if (!confirm('ì •ë§ ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }

      try {
        const response = await fetch(`/admin/notices/${id}`, {
          method: 'DELETE',
          credentials: 'include'
        });

        const result = await response.json();
        if (result.success) {
          alert('ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          location.reload();
        } else {
          alert(result.error || 'ê³µì§€ì‚¬í•­ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ê³µì§€ì‚¬í•­ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ì•„ì´ì½˜ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥
    function updateIconPreview(selectId, previewId, iconId, textId, customInputId) {
      const select = document.getElementById(selectId);
      const preview = document.getElementById(previewId);
      const iconElement = document.getElementById(iconId);
      const textElement = document.getElementById(textId);
      const customInput = document.getElementById(customInputId);
      const colorSelect = selectId.includes('add') ? document.getElementById('addNoticeIconColor') : document.getElementById('editNoticeIconColor');
      
      const selectedValue = select.value;
      const customValue = customInput.value.trim();
      const iconClass = customValue || selectedValue;
      const iconColor = colorSelect.value;
      
      if (iconClass) {
        iconElement.className = `bi ${iconClass}`;
        if (iconColor) {
          iconElement.className += ` text-${iconColor}`;
        }
        textElement.textContent = iconClass;
        preview.style.display = 'inline-flex';
      } else {
        preview.style.display = 'none';
      }
    }

    // ì¶”ê°€ ëª¨ë‹¬ ì•„ì´ì½˜ ë¯¸ë¦¬ë³´ê¸°
    document.getElementById('addNoticeIconClass').addEventListener('change', function() {
      document.getElementById('addNoticeIconClassCustom').value = '';
      updateIconPreview('addNoticeIconClass', 'addNoticeIconPreview', 'addNoticeIconPreviewIcon', 'addNoticeIconPreviewText', 'addNoticeIconClassCustom');
    });
    document.getElementById('addNoticeIconClassCustom').addEventListener('input', function() {
      if (this.value.trim()) {
        document.getElementById('addNoticeIconClass').value = '';
      }
      updateIconPreview('addNoticeIconClass', 'addNoticeIconPreview', 'addNoticeIconPreviewIcon', 'addNoticeIconPreviewText', 'addNoticeIconClassCustom');
    });
    document.getElementById('addNoticeIconColor').addEventListener('change', function() {
      updateIconPreview('addNoticeIconClass', 'addNoticeIconPreview', 'addNoticeIconPreviewIcon', 'addNoticeIconPreviewText', 'addNoticeIconClassCustom');
    });

    // ìˆ˜ì • ëª¨ë‹¬ ì•„ì´ì½˜ ë¯¸ë¦¬ë³´ê¸°
    document.getElementById('editNoticeIconClass').addEventListener('change', function() {
      document.getElementById('editNoticeIconClassCustom').value = '';
      updateIconPreview('editNoticeIconClass', 'editNoticeIconPreview', 'editNoticeIconPreviewIcon', 'editNoticeIconPreviewText', 'editNoticeIconClassCustom');
    });
    document.getElementById('editNoticeIconClassCustom').addEventListener('input', function() {
      if (this.value.trim()) {
        document.getElementById('editNoticeIconClass').value = '';
      }
      updateIconPreview('editNoticeIconClass', 'editNoticeIconPreview', 'editNoticeIconPreviewIcon', 'editNoticeIconPreviewText', 'editNoticeIconClassCustom');
    });
    document.getElementById('editNoticeIconColor').addEventListener('change', function() {
      updateIconPreview('editNoticeIconClass', 'editNoticeIconPreview', 'editNoticeIconPreviewIcon', 'editNoticeIconPreviewText', 'editNoticeIconClassCustom');
    });
  </script>

  <!-- ìƒˆ ì•Œë¦¼ ì¶”ê°€ ëª¨ë‹¬ -->
  <div class="modal fade" id="addAnnouncementModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ìƒˆ í˜‘íšŒì•Œë¦¼ ì¶”ê°€</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="addAnnouncementForm">
            <div class="mb-3">
              <label class="form-label">ë‚´ìš© <span class="text-danger">*</span></label>
              <textarea class="form-control" id="addContent" rows="3" required placeholder="í˜‘íšŒì•Œë¦¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">í‘œì‹œ ìˆœì„œ</label>
              <input type="number" class="form-control" id="addDisplayOrder" value="0" min="0">
              <small class="text-muted">ìˆ«ìê°€ ì‘ì„ìˆ˜ë¡ ë¨¼ì € í‘œì‹œë©ë‹ˆë‹¤.</small>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <button type="button" class="btn btn-primary" onclick="saveAnnouncement()">ì €ì¥</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì•Œë¦¼ ìˆ˜ì • ëª¨ë‹¬ -->
  <div class="modal fade" id="editAnnouncementModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">í˜‘íšŒì•Œë¦¼ ìˆ˜ì •</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="editAnnouncementForm">
            <input type="hidden" id="editId">
            <div class="mb-3">
              <label class="form-label">ë‚´ìš© <span class="text-danger">*</span></label>
              <textarea class="form-control" id="editContent" rows="3" required></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">í‘œì‹œ ìˆœì„œ</label>
              <input type="number" class="form-control" id="editDisplayOrder" min="0">
            </div>
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="editIsActive">
                <label class="form-check-label" for="editIsActive">í™œì„±í™”</label>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <button type="button" class="btn btn-primary" onclick="updateAnnouncement()">ìˆ˜ì •</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ìƒˆ ê³µì§€ì‚¬í•­ ì¶”ê°€ ëª¨ë‹¬ -->
  <div class="modal fade" id="addNoticeModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ìƒˆ ê³µì§€ì‚¬í•­ ì¶”ê°€</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="addNoticeForm">
            <div class="mb-3">
              <label class="form-label">ì œëª© <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="addNoticeTitle" required placeholder="ê³µì§€ì‚¬í•­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">ì•„ì´ì½˜ í´ë˜ìŠ¤</label>
                <select class="form-select" id="addNoticeIconClass">
                  <option value="">ì„ íƒì•ˆí•¨</option>
                  <option value="bi-bell">ğŸ”” ë²¨ (bell)</option>
                  <option value="bi-megaphone">ğŸ“¢ í™•ì„±ê¸° (megaphone)</option>
                  <option value="bi-calendar-event">ğŸ“… ë‹¬ë ¥ (calendar-event)</option>
                  <option value="bi-info-circle">â„¹ï¸ ì •ë³´ (info-circle)</option>
                  <option value="bi-exclamation-triangle">âš ï¸ ê²½ê³  (exclamation-triangle)</option>
                  <option value="bi-check-circle">âœ… ì²´í¬ (check-circle)</option>
                  <option value="bi-star">â­ ë³„ (star)</option>
                  <option value="bi-flag">ğŸš© ê¹ƒë°œ (flag)</option>
                  <option value="bi-bullhorn">ğŸ“£ ë‚˜íŒ” (bullhorn)</option>
                  <option value="bi-file-earmark-text">ğŸ“„ ë¬¸ì„œ (file-earmark-text)</option>
                </select>
                <div id="addNoticeIconPreview" class="icon-preview" style="display:none;">
                  <span>ë¯¸ë¦¬ë³´ê¸°:</span>
                  <i id="addNoticeIconPreviewIcon"></i>
                  <span id="addNoticeIconPreviewText"></span>
                </div>
                <small class="text-muted">ì•„ì´ì½˜ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">ì•„ì´ì½˜ ìƒ‰ìƒ</label>
                <select class="form-select" id="addNoticeIconColor">
                  <option value="">ì„ íƒì•ˆí•¨</option>
                  <option value="primary">Primary (íŒŒë€ìƒ‰)</option>
                  <option value="success">Success (ì´ˆë¡ìƒ‰)</option>
                  <option value="warning">Warning (ë…¸ë€ìƒ‰)</option>
                  <option value="danger">Danger (ë¹¨ê°„ìƒ‰)</option>
                  <option value="info">Info (í•˜ëŠ˜ìƒ‰)</option>
                </select>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">ì•„ì´ì½˜ í´ë˜ìŠ¤ ì§ì ‘ ì…ë ¥ (ì„ íƒì‚¬í•­)</label>
              <input type="text" class="form-control" id="addNoticeIconClassCustom" placeholder="ì˜ˆ: bi-custom-icon">
              <small class="text-muted">ìœ„ ëª©ë¡ì— ì—†ëŠ” ì•„ì´ì½˜ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.</small>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">ë‚ ì§œ</label>
                <input type="text" class="form-control" id="addNoticeDate" placeholder="ì˜ˆ: 2025.11.13">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">í‘œì‹œ ìˆœì„œ</label>
                <input type="number" class="form-control" id="addNoticeDisplayOrder" value="0" min="0">
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">ë§í¬ (ì„ íƒì‚¬í•­)</label>
              <input type="text" class="form-control" id="addNoticeLink" placeholder="í´ë¦­ ì‹œ ì´ë™í•  URL">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <button type="button" class="btn btn-warning" onclick="saveNotice()">ì €ì¥</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ê³µì§€ì‚¬í•­ ìˆ˜ì • ëª¨ë‹¬ -->
  <div class="modal fade" id="editNoticeModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ê³µì§€ì‚¬í•­ ìˆ˜ì •</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="editNoticeForm">
            <input type="hidden" id="editNoticeId">
            <div class="mb-3">
              <label class="form-label">ì œëª© <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="editNoticeTitle" required>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">ì•„ì´ì½˜ í´ë˜ìŠ¤</label>
                <select class="form-select" id="editNoticeIconClass">
                  <option value="">ì„ íƒì•ˆí•¨</option>
                  <option value="bi-bell">ğŸ”” ë²¨ (bell)</option>
                  <option value="bi-megaphone">ğŸ“¢ í™•ì„±ê¸° (megaphone)</option>
                  <option value="bi-calendar-event">ğŸ“… ë‹¬ë ¥ (calendar-event)</option>
                  <option value="bi-info-circle">â„¹ï¸ ì •ë³´ (info-circle)</option>
                  <option value="bi-exclamation-triangle">âš ï¸ ê²½ê³  (exclamation-triangle)</option>
                  <option value="bi-check-circle">âœ… ì²´í¬ (check-circle)</option>
                  <option value="bi-star">â­ ë³„ (star)</option>
                  <option value="bi-flag">ğŸš© ê¹ƒë°œ (flag)</option>
                  <option value="bi-bullhorn">ğŸ“£ ë‚˜íŒ” (bullhorn)</option>
                  <option value="bi-file-earmark-text">ğŸ“„ ë¬¸ì„œ (file-earmark-text)</option>
                </select>
                <div id="editNoticeIconPreview" class="icon-preview" style="display:none;">
                  <span>ë¯¸ë¦¬ë³´ê¸°:</span>
                  <i id="editNoticeIconPreviewIcon"></i>
                  <span id="editNoticeIconPreviewText"></span>
                </div>
                <small class="text-muted">ì•„ì´ì½˜ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">ì•„ì´ì½˜ ìƒ‰ìƒ</label>
                <select class="form-select" id="editNoticeIconColor">
                  <option value="">ì„ íƒì•ˆí•¨</option>
                  <option value="primary">Primary (íŒŒë€ìƒ‰)</option>
                  <option value="success">Success (ì´ˆë¡ìƒ‰)</option>
                  <option value="warning">Warning (ë…¸ë€ìƒ‰)</option>
                  <option value="danger">Danger (ë¹¨ê°„ìƒ‰)</option>
                  <option value="info">Info (í•˜ëŠ˜ìƒ‰)</option>
                </select>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">ì•„ì´ì½˜ í´ë˜ìŠ¤ ì§ì ‘ ì…ë ¥ (ì„ íƒì‚¬í•­)</label>
              <input type="text" class="form-control" id="editNoticeIconClassCustom" placeholder="ì˜ˆ: bi-custom-icon">
              <small class="text-muted">ìœ„ ëª©ë¡ì— ì—†ëŠ” ì•„ì´ì½˜ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.</small>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">ë‚ ì§œ</label>
                <input type="text" class="form-control" id="editNoticeDate" placeholder="ì˜ˆ: 2025.11.13">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">í‘œì‹œ ìˆœì„œ</label>
                <input type="number" class="form-control" id="editNoticeDisplayOrder" min="0">
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">ë§í¬ (ì„ íƒì‚¬í•­)</label>
              <input type="text" class="form-control" id="editNoticeLink" placeholder="í´ë¦­ ì‹œ ì´ë™í•  URL">
            </div>
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="editNoticeIsActive">
                <label class="form-check-label" for="editNoticeIsActive">í™œì„±í™”</label>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <button type="button" class="btn btn-warning" onclick="updateNotice()">ìˆ˜ì •</button>
        </div>
      </div>
    </div>
  </div>
</body>
</html>

