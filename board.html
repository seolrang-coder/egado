<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>게시판 | 관악구장애인단체연합회</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--brand:#4b4b8f;--brand-dark:#352f74;--muted:#6c757d;--bg:#f3f3f3}
    body{font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#fff;color:#222}
    .topbar{font-size:12px;background:#f8f9fa;border-bottom:1px solid #e9ecef}
    .navbar-brand img{height:44px}
    .brand-title{font-weight:800;color:var(--brand-dark);font-size:1.95rem;letter-spacing:-.2px}
    @media (max-width: 576px){.brand-title{display:none}}
    .mainnav{border-bottom:1px solid #e9ecef}
    .mainnav .nav-link{font-weight:600;color:#333}
    .mainnav .nav-link:hover{color:var(--brand)}
    .footer{background:#2d2142;color:#d9d6e5}
    .footer a{color:#e3def2;text-decoration:none}
    .footer a:hover{text-decoration:underline}
    .footer-brand img{height:36px}
    .board-card{box-shadow:0 2px 10px rgba(0,0,0,0.08);border-radius:0.75rem;overflow:hidden;margin-bottom:2rem}
    .board-card-header{background:linear-gradient(135deg,#6b7ba8 0%,#8a9bc4 100%);color:#fff;padding:1.25rem 1.5rem;display:flex;justify-content:space-between;align-items:center}
    .board-card-header h3{margin:0;font-size:1.25rem;font-weight:600;display:flex;align-items:center;gap:0.75rem}
    .board-card-header .badge{font-size:0.875rem;padding:0.375rem 0.75rem}
    .notice-card .board-card-header{background:linear-gradient(135deg,#ffd54f 0%,#ffe082 100%);color:#000}
    .board-table{width:100%;margin:0;border-collapse:separate;border-spacing:0}
    .board-table thead{background:#f8f9fa}
    .board-table th{padding:1rem;text-align:center;font-weight:600;font-size:0.875rem;color:#495057;border-bottom:2px solid #dee2e6;white-space:nowrap}
    .board-table td{padding:1rem;text-align:center;font-size:0.875rem;color:#6c757d;border-bottom:1px solid #e9ecef;vertical-align:middle}
    .board-table tbody tr{transition:all 0.2s ease}
    .board-table tbody tr:hover{background-color:#f8f9fa;transform:translateX(4px)}
    .board-table tbody tr.notice-row{background-color:#fffbf0}
    .board-table tbody tr.notice-row:hover{background-color:#fff8e1;transform:translateX(4px)}
    .board-table .col-number{width:80px;font-weight:600;color:#4b4b8f}
    .board-table .col-title{text-align:left;width:auto}
    .board-table .col-author{width:150px}
    .board-table .col-date{width:120px}
    .board-table .col-views{width:80px}
    .board-table .title-link{color:#212529;text-decoration:none;display:inline-flex;align-items:center;gap:0.5rem;font-weight:500;transition:color 0.2s}
    .board-table .title-link:hover{color:#4b4b8f;text-decoration:none}
    .board-table .title-link i{font-size:0.75rem;opacity:0.6}
    .empty-state{text-align:center;padding:3rem 1.5rem;color:#6c757d}
    .empty-state i{font-size:3rem;opacity:0.3;margin-bottom:1rem;display:block}
    .admin-controls{display:none}
    .admin-controls.show{display:block}
    .pagination-wrapper{margin-top:2rem}
  </style>
</head>
<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="container d-flex justify-content-end align-items-center gap-3 py-1">
      <div id="userInfo" style="display:none;">
        <span id="usernameDisplay" class="text-muted me-2"></span>
        <form action="/logout" method="post" style="display:inline;">
          <button type="submit" class="btn btn-link link-secondary p-0" style="text-decoration:none;">로그아웃</button>
        </form>
      </div>
      <div id="guestInfo">
        <a href="login.html" class="link-secondary">로그인</a>
        <a href="register.html" class="link-secondary">회원가입</a>
      </div>
    </div>
  </div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white mainnav">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-3" href="index.html">
        <img src="img/footer-logo.png" alt="로고" />
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="토글 내비게이션">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="about.html" id="aboutDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">협회소개</a>
            <ul class="dropdown-menu" aria-labelledby="aboutDropdown">
              <li><a class="dropdown-item" href="about.html">협회소개</a></li>
              <li><a class="dropdown-item" href="org.html">조직도</a></li>
              <li><a class="dropdown-item" href="history.html">연혁</a></li>
              <li><a class="dropdown-item" href="vision.html">비전</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="business.html">협회사업</a></li>
          <li class="nav-item"><a class="nav-link" href="info.html">정보마당</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="activity-lovehouse.html" id="activityDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">행사 및 활동</a>
            <ul class="dropdown-menu" aria-labelledby="activityDropdown">
              <li><a class="dropdown-item" href="activity-lovehouse.html">러브하우스</a></li>
              <li><a class="dropdown-item" href="activity-volunteer.html">행사 및 환경봉사단</a></li>
              <li><a class="dropdown-item" href="activity-mobilitycare.html">전동보장구교육&케어</a></li>
              <li><a class="dropdown-item" href="activity-beauty.html">무료 이·미용 봉사</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link active" href="board.html">게시판</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="affiliateDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">연합회소속단체</a>
            <ul class="dropdown-menu" aria-labelledby="affiliateDropdown">
              <li><a class="dropdown-item" href="http://www.sappd.or.kr/" target="_blank" rel="noopener noreferrer">사)서울지체장애인협회</a></li>
              <li><a class="dropdown-item" href="http://www.kadi.or.kr/kadi/" target="_blank" rel="noopener noreferrer">사)한국장애인정보화협회</a></li>
              <li><a class="dropdown-item" href="https://kaiad.or.kr/" target="_blank" rel="noopener noreferrer">사)한국산업재해장애인협회</a></li>
              <li><a class="dropdown-item" href="http://www.kaed.or.kr/" target="_blank" rel="noopener noreferrer">사)한국장애인기업협회</a></li>
              <li><a class="dropdown-item" href="http://www.nanum.tv/" target="_blank" rel="noopener noreferrer">사)국제장애인문화교류협회</a></li>
              <li><a class="dropdown-item" href="http://www.kofd.co.kr/kofd/" target="_blank" rel="noopener noreferrer">사)한국기능장애인협회</a></li>
              <li><a class="dropdown-item" href="https://www.deafkorea.com/main/" target="_blank" rel="noopener noreferrer">사)한국농아인협회</a></li>
              <li><a class="dropdown-item" href="http://www.bluesky82.org/" target="_blank" rel="noopener noreferrer">사)한국장애인문화협회</a></li>
              <li><a class="dropdown-item" href="https://www.kdwa.or.kr/main" target="_blank" rel="noopener noreferrer">사)서울신체장애인복지회</a></li>
              <li><a class="dropdown-item" href="#">사)열린정보장애인협회</a></li>
              <li><a class="dropdown-item" href="#">사)서울시각장애인연합회</a></li>
              <li><a class="dropdown-item" href="#">사)한국장애인환경실천협회</a></li>
              <li><a class="dropdown-item" href="nanum.html">전국장애인나눔협동조합</a></li>
              <li><a class="dropdown-item" href="aboutgolf.html">한국장애인스크린파크골프협회</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="directions.html">오시는길</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-5">
    <!-- 페이지 헤더 -->
    <section class="page-header text-center mb-5">
      <h2 class="display-8 fw-bold text-dark mb-3">게시판</h2>
    </section>

    <!-- 공지사항 섹션 -->
    <section class="board-card notice-card">
      <div class="board-card-header">
        <h3>
          공지사항
          <span class="badge bg-dark" id="noticeCount">0</span>
        </h3>
        <div class="admin-controls" id="adminControls">
          <a href="/board/new?category=general" class="btn btn-light btn-sm">
            <i class="bi bi-pencil-square me-1"></i>글 작성
          </a>
        </div>
      </div>
      <div class="table-responsive">
        <table class="board-table">
          <thead>
            <tr>
              <th class="col-number">번호</th>
              <th class="col-title">제목</th>
              <th class="col-author">작성자</th>
              <th class="col-date">작성일</th>
              <th class="col-views">조회</th>
            </tr>
          </thead>
          <tbody id="noticesList">
            <tr>
              <td colspan="5" class="empty-state">
                <div class="spinner-border spinner-border-sm text-warning" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- 일반 게시판과 자유게시판 섹션 -->
    <div class="row g-4">
      <!-- 일반 게시판 섹션 -->
      <div class="col-12 col-md-6">
        <section class="board-card h-100">
          <div class="board-card-header">
            <h3>
              일반 게시판
              <span class="badge bg-light text-dark" id="postsCount">0</span>
            </h3>
            <div class="admin-controls" id="generalAdminControls">
              <a href="/board/new?category=general" class="btn btn-light btn-sm">
                <i class="bi bi-pencil-square me-1"></i>글 작성
              </a>
            </div>
          </div>
      <div class="table-responsive">
        <table class="board-table">
          <thead>
            <tr>
              <th class="col-number">번호</th>
              <th class="col-title">제목</th>
              <th class="col-author">작성자</th>
              <th class="col-date">작성일</th>
              <th class="col-views">조회</th>
            </tr>
          </thead>
          <tbody id="postsList">
            <tr>
              <td colspan="5" class="empty-state">
                <div class="spinner-border spinner-border-sm text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
          <!-- 페이지네이션 -->
          <div class="pagination-wrapper">
            <nav aria-label="게시판 페이지네이션" id="paginationNav" style="display:none;">
              <ul class="pagination justify-content-center mb-0" id="paginationList"></ul>
            </nav>
          </div>
        </section>
      </div>

      <!-- 자유게시판 섹션 -->
      <div class="col-12 col-md-6">
        <section class="board-card h-100">
          <div class="board-card-header">
            <h3>
              자유게시판
              <span class="badge bg-light text-dark" id="freePostsCount">0</span>
            </h3>
            <div id="freeBoardWriteBtn" style="display:none;">
              <a href="/board/new?category=free" class="btn btn-light btn-sm">
                <i class="bi bi-pencil-square me-1"></i>글 작성
              </a>
            </div>
          </div>
          <div class="table-responsive">
            <table class="board-table">
              <thead>
                <tr>
                  <th class="col-number">번호</th>
                  <th class="col-title">제목</th>
                  <th class="col-author">작성자</th>
                  <th class="col-date">작성일</th>
                  <th class="col-views">조회</th>
                </tr>
              </thead>
              <tbody id="freePostsList">
                <tr>
                  <td colspan="5" class="empty-state">
                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- 페이지네이션 -->
          <div class="pagination-wrapper">
            <nav aria-label="자유게시판 페이지네이션" id="freePaginationNav" style="display:none;">
              <ul class="pagination justify-content-center mb-0" id="freePaginationList"></ul>
            </nav>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer pt-4 pb-5 mt-5">
    <div class="container">
      <div class="row g-3">
        <div class="col-12 col-lg-8">
          <a class="footer-brand d-inline-flex align-items-center gap-2 mb-2" href="index.html">
            <img src="img/main.jpg" alt="관악구장애인단체연합회 로고" />
            <span class="fw-bold text-white">관악구장애인단체연합회</span>
          </a>
          <div class="small text-secondary">고유번호:119-82-74874 | 협회장: 송 낙 규</div>
          <div class="small text-secondary">서울특별시 남부순환로 1696, 뉴명지빌딩 (5,6,7층) | 대표 02-871-5686 | FAX 02-3281-3702</div>
          <div class="small text-secondary">Copyright &copy; 2025 관악구장애인단체연합회. All Rights Reserved.</div>
        </div>
        <div class="col-12 col-lg-4">
          <div class="d-flex gap-3 justify-content-lg-end small">
            <a href="terms.html">이용약관</a>
            <a href="privacy.html">개인정보처리방침</a>
            <a href="email-policy.html">이메일무단수집거부</a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function formatDate(dateString) {
      if (!dateString) return '';
      
      // SQLite DATETIME 형식 (YYYY-MM-DD HH:MM:SS)을 직접 파싱하여 날짜만 추출
      // 서버에서 저장된 날짜를 그대로 사용 (시간대 변환 없음)
      let year, month, day;
      
      if (!dateString.includes('T') && !dateString.includes('Z') && !dateString.includes('+')) {
        // YYYY-MM-DD HH:MM:SS 형식
        const parts = dateString.split(' ');
        const datePart = parts[0].split('-');
        year = parseInt(datePart[0]);
        month = parseInt(datePart[1]);
        day = parseInt(datePart[2]);
      } else if (dateString.includes('T')) {
        // ISO 형식
        const datePart = dateString.split('T')[0].split('-');
        year = parseInt(datePart[0]);
        month = parseInt(datePart[1]);
        day = parseInt(datePart[2]);
      } else {
        // 기타 형식은 Date 객체로 파싱
        const date = new Date(dateString);
        year = date.getFullYear();
        month = date.getMonth() + 1;
        day = date.getDate();
      }
      
      // YYYY.MM.DD 형식으로 반환
      return `${year}.${String(month).padStart(2, '0')}.${String(day).padStart(2, '0')}`;
    }
    
    let currentPage = 1;
    
    function renderPostRow(post, isNotice = false, index = 0, totalPosts = 0, currentPageNum = 1) {
      const postUrl = `/posts/${post.id}`;
      let number;
      if (isNotice) {
        number = '<span class="badge bg-warning text-dark">공지</span>';
      } else {
        number = totalPosts - ((currentPageNum - 1) * 10) - index;
      }
      const views = post.view_count || 0;
      
      return `
        <tr class="${isNotice ? 'notice-row' : ''}" onclick="window.location.href='${postUrl}'" style="cursor:pointer">
          <td class="col-number">${number}</td>
          <td class="col-title">
            <a href="${postUrl}" class="title-link" onclick="event.stopPropagation(); window.location.href='${postUrl}'; return false;">
              <i class="bi bi-file-text"></i>
              ${escapeHtml(post.title)}
            </a>
          </td>
          <td class="col-author">${escapeHtml(post.username)}</td>
          <td class="col-date">${formatDate(post.created_at)}</td>
          <td class="col-views">
            <i class="bi bi-eye text-muted"></i> ${views}
          </td>
        </tr>
      `;
    }
    
    function renderPagination(pagination) {
      const paginationNav = document.getElementById('paginationNav');
      const paginationList = document.getElementById('paginationList');
      
      if (!pagination || pagination.totalPages <= 1) {
        paginationNav.style.display = 'none';
        return;
      }
      
      paginationNav.style.display = 'block';
      let html = '';
      
      // 이전 버튼
      html += `<li class="page-item ${!pagination.hasPrev ? 'disabled' : ''}">
        <a class="page-link" href="#" onclick="event.preventDefault(); if(${pagination.hasPrev}) loadBoard(${pagination.currentPage - 1}); return false;">
          <i class="bi bi-chevron-left"></i>
        </a>
      </li>`;
      
      // 페이지 번호
      const startPage = Math.max(1, pagination.currentPage - 2);
      const endPage = Math.min(pagination.totalPages, pagination.currentPage + 2);
      
      if (startPage > 1) {
        html += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadBoard(1); return false;">1</a></li>`;
        if (startPage > 2) {
          html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
      }
      
      for (let i = startPage; i <= endPage; i++) {
        html += `<li class="page-item ${i === pagination.currentPage ? 'active' : ''}">
          <a class="page-link" href="#" onclick="event.preventDefault(); loadBoard(${i}); return false;">${i}</a>
        </li>`;
      }
      
      if (endPage < pagination.totalPages) {
        if (endPage < pagination.totalPages - 1) {
          html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
        html += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadBoard(${pagination.totalPages}); return false;">${pagination.totalPages}</a></li>`;
      }
      
      // 다음 버튼
      html += `<li class="page-item ${!pagination.hasNext ? 'disabled' : ''}">
        <a class="page-link" href="#" onclick="event.preventDefault(); if(${pagination.hasNext}) loadBoard(${pagination.currentPage + 1}); return false;">
          <i class="bi bi-chevron-right"></i>
        </a>
      </li>`;
      
      paginationList.innerHTML = html;
    }
    
    let currentFreePage = 1;
    
    async function loadFreeBoard(page = 1) {
      try {
        currentFreePage = page;
        const res = await fetch(`/api/board/free?page=${page}`, {
          credentials: 'include'
        });
        
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        
        const data = await res.json();
        
        // 자유게시판 게시글 렌더링
        const freePostsList = document.getElementById('freePostsList');
        const freePostsCount = document.getElementById('freePostsCount');
        
        if (!data.posts || data.posts.length === 0) {
          freePostsList.innerHTML = `
            <tr>
              <td colspan="5" class="empty-state">
                <i class="bi bi-inbox"></i>
                <p class="mb-0">등록된 게시글이 없습니다.</p>
              </td>
            </tr>
          `;
          freePostsCount.textContent = '0';
        } else {
          const totalPosts = data.pagination ? data.pagination.totalPosts : data.posts.length;
          freePostsList.innerHTML = data.posts.map((post, index) => renderPostRow(post, false, index, totalPosts, page)).join('');
          freePostsCount.textContent = totalPosts;
        }
        
        // 페이지네이션 렌더링
        if (data.pagination) {
          renderFreePagination(data.pagination);
        }
      } catch (error) {
        console.error('Error loading free board:', error);
        document.getElementById('freePostsList').innerHTML = `
          <tr>
            <td colspan="5" class="empty-state text-danger">
              <i class="bi bi-exclamation-triangle"></i>
              <p class="mb-0">게시글을 불러오는 중 오류가 발생했습니다.</p>
            </td>
          </tr>
        `;
      }
    }
    
    function renderFreePagination(pagination) {
      const paginationNav = document.getElementById('freePaginationNav');
      const paginationList = document.getElementById('freePaginationList');
      
      if (!pagination || pagination.totalPages <= 1) {
        paginationNav.style.display = 'none';
        return;
      }
      
      paginationNav.style.display = 'block';
      let html = '';
      
      // 이전 버튼
      html += `<li class="page-item ${!pagination.hasPrev ? 'disabled' : ''}">
        <a class="page-link" href="#" onclick="event.preventDefault(); if(${pagination.hasPrev}) loadFreeBoard(${pagination.currentPage - 1}); return false;">
          <i class="bi bi-chevron-left"></i>
        </a>
      </li>`;
      
      // 페이지 번호
      const startPage = Math.max(1, pagination.currentPage - 2);
      const endPage = Math.min(pagination.totalPages, pagination.currentPage + 2);
      
      if (startPage > 1) {
        html += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadFreeBoard(1); return false;">1</a></li>`;
        if (startPage > 2) {
          html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
      }
      
      for (let i = startPage; i <= endPage; i++) {
        html += `<li class="page-item ${i === pagination.currentPage ? 'active' : ''}">
          <a class="page-link" href="#" onclick="event.preventDefault(); loadFreeBoard(${i}); return false;">${i}</a>
        </li>`;
      }
      
      if (endPage < pagination.totalPages) {
        if (endPage < pagination.totalPages - 1) {
          html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
        html += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadFreeBoard(${pagination.totalPages}); return false;">${pagination.totalPages}</a></li>`;
      }
      
      // 다음 버튼
      html += `<li class="page-item ${!pagination.hasNext ? 'disabled' : ''}">
        <a class="page-link" href="#" onclick="event.preventDefault(); if(${pagination.hasNext}) loadFreeBoard(${pagination.currentPage + 1}); return false;">
          <i class="bi bi-chevron-right"></i>
        </a>
      </li>`;
      
      paginationList.innerHTML = html;
    }
    
    async function loadBoard(page = 1) {
      try {
        currentPage = page;
        const res = await fetch(`/api/board?page=${page}`, {
          credentials: 'include'
        });
        
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        
        const data = await res.json();
        
        // 공지사항 렌더링
        const noticesList = document.getElementById('noticesList');
        const noticeCount = document.getElementById('noticeCount');
        
        if (!data.notices || data.notices.length === 0) {
          noticesList.innerHTML = `
            <tr>
              <td colspan="5" class="empty-state">
                <i class="bi bi-inbox"></i>
                <p class="mb-0">등록된 공지사항이 없습니다.</p>
              </td>
            </tr>
          `;
          noticeCount.textContent = '0';
        } else {
          noticesList.innerHTML = data.notices.map((notice, index) => renderPostRow(notice, true, index, 0, 1)).join('');
          noticeCount.textContent = data.notices.length;
        }
        
        // 일반 게시글 렌더링
        const postsList = document.getElementById('postsList');
        const postsCount = document.getElementById('postsCount');
        
        if (!data.posts || data.posts.length === 0) {
          postsList.innerHTML = `
            <tr>
              <td colspan="5" class="empty-state">
                <i class="bi bi-inbox"></i>
                <p class="mb-0">등록된 게시글이 없습니다.</p>
              </td>
            </tr>
          `;
          postsCount.textContent = '0';
        } else {
          const totalPosts = data.pagination ? data.pagination.totalPosts : data.posts.length;
          postsList.innerHTML = data.posts.map((post, index) => renderPostRow(post, false, index, totalPosts, page)).join('');
          postsCount.textContent = totalPosts;
        }
        
        // 페이지네이션 렌더링
        if (data.pagination) {
          renderPagination(data.pagination);
        }
      } catch (error) {
        console.error('Error loading board:', error);
        let errorMsg = '게시글을 불러오는 중 오류가 발생했습니다.';
        if (error.message) {
          errorMsg = error.message;
        } else if (error instanceof TypeError && error.message.includes('fetch')) {
          errorMsg = '서버에 연결할 수 없습니다. 서버가 실행 중인지 확인해주세요.';
        }
        document.getElementById('noticesList').innerHTML = `
          <tr>
            <td colspan="5" class="empty-state text-danger">
              <i class="bi bi-exclamation-triangle"></i>
              <p class="mb-0">${escapeHtml(errorMsg)}</p>
            </td>
          </tr>
        `;
        document.getElementById('postsList').innerHTML = `
          <tr>
            <td colspan="5" class="empty-state text-danger">
              <i class="bi bi-exclamation-triangle"></i>
              <p class="mb-0">${escapeHtml(errorMsg)}</p>
            </td>
          </tr>
        `;
      }
    }
    
    async function checkAdmin() {
      try {
        const res = await fetch('/api/check-admin', {
          credentials: 'include'
        });
        const data = await res.json();
        if (data.isAdmin) {
          const adminControls = document.getElementById('adminControls');
          if (adminControls) adminControls.classList.add('show');
          const generalAdminControls = document.getElementById('generalAdminControls');
          if (generalAdminControls) generalAdminControls.classList.add('show');
        }
      } catch (error) {
        console.error('Error checking admin:', error);
      }
    }
    
    // 로그인 상태 확인
    async function checkLoginStatus() {
      try {
        const res = await fetch('/api/user', {
          credentials: 'include'
        });
        const data = await res.json();
        
        if (data.loggedIn) {
          document.getElementById('userInfo').style.display = 'block';
          document.getElementById('guestInfo').style.display = 'none';
          document.getElementById('usernameDisplay').textContent = `${data.username}님`;
          // 일반회원도 자유게시판에 글쓰기 가능
          document.getElementById('freeBoardWriteBtn').style.display = 'block';
        } else {
          document.getElementById('userInfo').style.display = 'none';
          document.getElementById('guestInfo').style.display = 'block';
        }
      } catch (error) {
        console.error('Error checking login status:', error);
      }
    }
    
    // 페이지 로드 시 실행
    checkLoginStatus();
    checkAdmin();
    loadBoard(1);
    loadFreeBoard(1);
  </script>
</body>
</html>
